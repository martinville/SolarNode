<!DOCTYPE html>
<html>
<head>
  <title>SolarNODE</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico">
</head>
<body>

<link href="bootstrap.min.css" rel="stylesheet" >
<link href="bootstrap.min.css.gz" rel="stylesheet" >

<style>

</style>

<body style="background-color:#1B1B1F;">


	<div class="container-sm">
			
			
			<div class="row">
		

				<div class="col-sm-12" style="margin-top:15px;">				
					<ul class="nav nav-tabs">
					  <li class="nav-item">
						<a id="iddeviceinfo" class="nav-link active" href="#" onclick="FuncTabCtrl('iddeviceinfo')"><img src="chip.png" alt="Bootstrap" class="img-fluid" width="30px;"></a>
					  </li>
					  <li class="nav-item" >
						<a id="idinverterinfo"  class="nav-link" href="#" onclick="FuncTabCtrl('idinverterinfo')"><img src="inverter.png" alt="Bootstrap" class="img-fluid" width="30px;"></a>
					  </li>					  
					  <li class="nav-item">
						<a id="idrecipes" class="nav-link" href="#" onclick="FuncTabCtrl('idrecipes')" ><img src="nodes.png" alt="Bootstrap" class="img-fluid" width="30px;"></a>
					  </li>
					  <li class="nav-item">
						<a id="idfilesysteminfo" class="nav-link" href="#" onclick="FuncTabCtrl('idfilesysteminfo')"><img src="micro-sd-card.png" alt="Bootstrap" class="img-fluid" width="30px;"></a>
					  </li>    
					  <li class="nav-item">
						<a id="idsystemsettings" class="nav-link" href="#" onclick="FuncTabCtrl('idsystemsettings')"><img src="settings.png" alt="Bootstrap" class="img-fluid" width="30px;"></a>
					  </li>

					</ul>				
					
					<div class="card bg-dark text-light" id="idDeviceInfoSection" style="visibility:visdible;display:block;">
					  <div class="card-body">							
							<h4><img src="chip.png" alt="Bootstrap" class="img-fluid" width="30px;"> Device Information</h4>
							
							  <br>
							  <div class="card card-body bg-dark text-light">
									
									<table class="table table-sm table-striped table-dark">
										<tbody style="font-size:12px;">
										<tr><td><h5>Device & Chip Information</h5></td><td></td></tr>
										<tr><td>Chip Model</td><td id="idchipmodel"></td></tr>
										<tr><td>Mac Address</td><td id="idmacaddr"></td></tr>
										<tr><td>CPU Temp</td><td id="idcputemp"></td></tr>
										<tr><td>CPU Count</td><td id="idcpucount"></td></tr>
										<tr><td>CPU Frequency</td><td id="idcpufreq"></td></tr>																
										<tr><td>Chip Capacity</td><td id="idchipcapacity"></td></tr>
										<tr><td>Sketch Capacity</td><td id="idsketchcapacity"></td></tr>
										<tr><td>Sketch Free Space</td><td id="idsketchfreecapacity"></td></tr>			
										<tr><td>Flash space Used</td><td id="idspaceused"></td></tr>
										<tr><td>Storage Info</td><td id="idDiskInfo"></td></tr>
										<tr><td>Up Time</td><td id="idUptime"></td></tr>
										<tr><td><h5>Network Connection Details</h5></td><td></td></tr>
										<tr><td>MDNS Name</td><td id="idMDNSName"></td></tr>
										<tr><td>Connected Wifi Access Point</td><td id="idAPName"></td></tr>
										<tr><td>Device IP</td><td id="idIPAddr"></td></tr>										
										</tbody>
									</table>
							  </div>
							
							
					  </div>
					</div>						
					<div class="card bg-dark text-light" id="idInverterInfoSection" style="visibility:hidden;display:none;">
					  <div class="card-body">
							
							<h4><img src="inverter.png" alt="Bootstrap" class="img-fluid" width="30px;"> Inverter Information</h4>
							  <br>
							  <div class="card card-body bg-dark text-light">
									<table class="table table-sm table-striped table-dark">									
										<tbody style="font-size:12px;">			
										<tr><td>Serial COM</td><td id="idserialcom"><span style="color:#55B56A;">--</span></td></tr>
										</tbody>
									</table>								
							  </div>	
					  </div>
					</div>
					<div class="card bg-dark text-light"  id="idRecipeInfoSection" style="visibility:hidden;display:none;">
					  <div class="card-body">							
							<h4><img src="nodes.png" alt="Bootstrap" class="img-fluid" width="30px;"> Direct RS232 Interface Recipes</h4> 
							<div class="btn-group float-end">
							  <button type="button" class="btn btn-sm btn-dark dropdown-toggle " data-bs-toggle="dropdown" aria-expanded="false">
								Options
							  </button>
							  <ul class="dropdown-menu">
								<li><a class="dropdown-item" href="#" data-bs-toggle="modal" data-bs-target="#CreateEndPoint">Create New Recipe</a></li>
								<li><a class="dropdown-item" href="#" onclick="FuncGetRecipes()">Refresh Recipes</a></li>
								<li><a class="dropdown-item" href="#">Download Recipe Files (Github Repository)</a></li>
								<li><hr class="dropdown-Divide Byr"></li>								
								<li><a class="dropdown-item" href="#" onclick="FuncExecRecipes()">Execute Recipes</a></li>
								<li><a class="dropdown-item" href="#" onclick="FuncLoadLog()" data-bs-toggle="modal" data-bs-target="#LogViewer">View Log</a></li>
							  </ul>
							</div>									  
								  
								  <span class="form-text text-light">List of configured data points.</span>
								  <br>
								  <br>
								  <div class="card card-body bg-dark text-light">
									
									<table class="table table-sm table-striped table-dark" id="idRecipeFiles" style="font-size:12px;">
										<tbody style="font-size:12px;">			
										<tr><td><b>#ID</td><td><b>Name</td><td><b class="float-end"></td></tr>
										<tr><td><div class="spinner-border text-warning" role="status"><span class="visually-hidden"></span></div></td><td></td><td></td></tr>										
										</tbody>
									</table>
									<br>
									
								  </div>
								  <br> 
								<a class="btn btn-dark btn-sm float-end"  role="button" onclick="FuncLoadLog()" data-bs-toggle="modal" data-bs-target="#LogViewer" >View Log</a>  								
								<span class="float-end" style="display:block;visibility: hidden;">|</span>
								<button type="button" class="btn btn-dark btn-sm float-end" onclick="FuncExecRecipes()">Execute Recipes</button>
							
	
							<br>
					  </div>

				  
					</div>
					<div class="card bg-dark text-light" id="idFileListInfoSection" style="visibility:hidden;display:none;">
					  <div class="card-body">
							  <h4><img src="micro-sd-card.png" alt="Bootstrap" class="img-fluid" width="30px;"> File Manager</h4>								  
							  <button type="button" class="btn btn-light btn-sm float-end" onclick="FuncGetFileList()">Refresh</button>
							  <span class="form-text text-light">List of files on this device.</span><br>
							  <i><small style="color:grey;">Admin mode must to be enable to be able to delete files.</small></i>
							  <br>
							  
							  <div class="card card-body bg-dark text-light">
								<table class="table table-sm table-striped table-dark" id="idFiles" style="font-size:12px;" >
								<tr><td><div class="spinner-border text-warning" role="status"><span class="visually-hidden"></span></div></td></tr>
								</table>
							  </div>							
					  </div>
					</div>
					<div class="card bg-dark text-light" id="idSettingsSection" style="visibility:hidden;display:none;">
					  <div class="card-body">
							<!-- Example single danger button -->
							<div class="btn-group float-end">
							  
							  <button type="button" class="btn btn-sm btn-dark dropdown-toggle " data-bs-toggle="dropdown" aria-expanded="false">
								Configuration
							  </button>
							  <ul class="dropdown-menu">
								<li><a class="dropdown-item" href="#" data-bs-toggle="modal" data-bs-target="#SetupHA">Configure Home Assistant</a></li>																
								<li><a class="dropdown-item" href="#">Download Recipe Files (Github Repository)</a></li>
								<li><hr class="dropdown-Divide Byr"></li>
								<li><a class="dropdown-item" href="#" data-bs-toggle="modal" data-bs-target="#SystemMaintanance">Enable Admin Mode</a></li>
								<li><a class="dropdown-item" href="#" onclick="FuncUpdateSystem()">Update Web Interface</a></li>
								<li><a class="dropdown-item" href="#" onclick="RebootDevice()">Reboot</a></li>
							  </ul>
							</div>					  
							  
							  <h4><img src="settings.png" alt="Bootstrap" class="img-fluid" width="30px;"> System Settings</h4>	
							<br>
							  <h5>General Settings</h5>
							  <hr></hr>
								<div class="form-check form-switch">
									<input class="form-check-input" type="checkbox" id="idToggleLog" onclick="FuncToggleLog()">
									<label class="form-check-label" for="flexSwitchCheckDefault">Enable Logging</label><br>
									<i><small style="color:grey;">Note: Logging can only be turned on when the device is in admin mode and is meant for debugging purposes only without any log rotation functionality. If left on permanently it may fill up internal storage causing unknown effects. It's recommended to delete the log when done debugging.</small></i>
								</div>

								<br>
	
					  </div>
					</div>						
					
					<div class="card bg-dark text-light" id="idDeviceInfoSection" style="visibility:visdible;display:block;">
					  <div class="card-body">																				 
						<div class="spinner-border text-warning" role="status" id="idSystemUpdating" style="visibility:hidden;display:none;"><span class="visually-hidden"></span></div>
						<img src="logo.png" alt="Bootstrap" class="img-fluid" width="250px;"> <small><small><small><small><small>V1.41</small></small></small></small></a>													
						<button type="button" class="btn btn-sm btn-light float-end" id="idAdminModestatus" style="visibility:visible;display:none;" onclick="FuncDisableAdminMode()" >Disable Admin Mode <span class="badge bg-danger">!</span></button>
							  
							  
					  </div>
					</div>	


					<br><br><br>
				</div>


<br><br><br>
	</div>
</div>


<!-- Create New recepe -->
<!-- Modal -->
<div class="modal modal-xl fade" id="CreateEndPoint" tabindex="-1" aria-labelledby="CreateEndPoint" aria-hidden="true">
  <div class="modal-dialog bg-dark">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="CreateEndPoint"><img src="nodes.png" alt="Bootstrap" class="img-fluid" width="50px;"> <span id="idEditRCP">Create New Recipe</span></h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
			<form>
			<div class="row" style="">
			 <div class="col-sm-3" style="">
			 <div class="mb-3">
				<label for="exampleInputEmail1" class="form-label">Address ID</label>
				<input type="text" class="form-control" name="fAddressID" id="fAddressID" onchange="FuncUpdateSystemName()">
				<div id="emailHelp" class="form-text"><small><i>See the Synsynk MODBUS Documentation for more information on address and IDs</i></small></div>
			  </div>
			  </div>
			  <div class="col-sm-3" style="">
				  <div class="mb-3">
					<label class="form-label">Address ID Firendly Name</label>
					<input type="text" class="form-control" name="fAddrFriendlyName" id="fAddrFriendlyName" onchange="FuncUpdateSystemName()" maxlength="25">				
				  </div>
				</div>
				<div class="col-sm-3" style="">
				  <div class="mb-3">
					<label class="form-label">Address ID System Name</label>
					<input type="text" class="form-control"  name="fAddrSystemName" id="fAddrSystemName" disabled>				
				  </div>				  
			  </div>
			  <div class="col-sm-3" style="">
			  <div class="mb-3">
				<label class="form-label">Unit Of Measurment</label>
					<select class="form-select" name="fUOM" id="fUOM" onchange="FuncUpdateSystemName()">
					  <option value="none">none</option>
					  <option value="state">state</option>
					  <option value="power_factor">power_factor</option>
					  <option value="temperature">temperature</option>					  
					  <option value="voltage">voltage</option>
					  <option value="current">current</option>
					  <option value="power">power</option>
					  <option value="energy">energy</option>
					  <option value="amp hour">amp hour</option>					  
					  <option value="frequency">frequency</option>						  	
					  <option value="time">time</option>	
					  <option value="battery">battery</option>

					</select>
			  </div>
			  </div>
			  <div class="col-sm-12" style="">Inverter Output Modifiers</div>
			  <div class="col-sm-3" style="">
				<div class="input-group mb-3">
					<select class="form-select" name="fFactor1" id="fFactor1">				
						<option value="Multiply By">Multiply By</option>
						<option value="Divide By">Divide By</option>
						<option value="Add">Add</option>
						<option value="Subtract">Subtract</option>
					</select>
					<input type="text" class="form-control" placeholder="" value="1" id="fFactor1Val" name="fFactor1Val">
			  </div>
			  </div>
			  <div class="col-sm-3" style="">
				<div class="input-group mb-3">
					<select class="form-select" name="fFactor2" id="fFactor2">				
						<option value="Multiply By">Multiply By</option>
						<option value="Divide By">Divide By</option>
						<option value="Add">Add</option>
						<option value="Subtract">Subtract</option>
					</select>
					<input type="text" class="form-control" placeholder="" value="1" id="fFactor2Val" name="fFactor2Val">
			  </div>
			  </div>
			  <div class="col-sm-3" style="">
				<div class="input-group mb-3">
					<select class="form-select" name="fFactor3" id="fFactor3">				
						<option value="Multiply By">Multiply By</option>
						<option value="Divide By">Divide By</option>
						<option value="Add">Add</option>
						<option value="Subtract">Subtract</option>
					</select>
					<input type="text" class="form-control" placeholder="" value="1" id="fFactor3Val" name="fFactor3Val">
			  </div>
			  </div>
			  <div class="col-sm-3" style="">
				<div class="input-group mb-3">
					<select class="form-select" name="fFactor4" id="fFactor4">				
						<option value="Multiply By">Multiply By</option>
						<option value="Divide By">Divide By</option>
						<option value="Add">Add</option>
						<option value="Subtract">Subtract</option>
					</select>
					<input type="text" class="form-control" placeholder="" value="1" id="fFactor4Val" name="fFactor4Val">
			  </div>
			  </div>
			  <div class="col-sm-12" style=""><small><i>Output from the inverter is given in number form. In some cases not usable as is and needs to be modified with a formula. You can leave default modifiers as is if you do not want to apply a formula.</i></small></div>
			  




			
			  
		</div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-sm btn-light" data-bs-dismiss="modal">Close</button>    
		<button type="button" class="btn btn-sm btn-dark" data-bs-dismiss="modal" onclick="FuncSaveRecipe()" >Save</button>
		</form>		
      </div>
    </div>
  </div>
</div>

<!-- Setup HA Config -->
<!-- Modal -->
<div class="modal modal-xl fade" id="SetupHA" tabindex="-1" aria-labelledby="SetupHA" aria-hidden="true">
  <div class="modal-dialog bg-dark">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="SetupHA"><img src="homeassistant.png" alt="Bootstrap" class="img-fluid" width="50px;"> Setup Home Assistant</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
		
			<form>
			<div class="row" style="">
			<div class="col-sm-6" style="">
			  <div class="mb-3">
				<label class="form-label">Home Assistant Server IP Address</label>
				<input type="text" name="fHAIP" class="form-control" id="fHAIP" aria-describedby="emailHelp">
				<div id="emailHelp" class="form-text"><small><i>IP of your Home Assistant server.</i></small></div>				
			  </div>
			</div>
			<div class="col-sm-6" style="">
			  <div class="mb-3">
				<label class="form-label">Home Assistant Port</label>
				<input type="text" name="fHAPort" class="form-control" id="fHAPort" value="8123">
				<div id="emailHelp" class="form-text"><small><i>Home Asisstant TCP port number default is (8123)</i></small></div>
			  </div>
			</div>
			<div class="col-sm-6" style="">
			  <div class="mb-3">
				<label class="form-label">Entity Prefix</label>
				<input type="text" name="fHAPreFix" class="form-control" id="fHAPreFix" value="">
				<div id="emailHelp" class="form-text"><small><i>When entities are created on Home Assistant they will be prefixed with this value. Leave blank if you dont want a prefix. Spaces are not allowed use alpha numeric characters only.</i></small></div>				
			  </div>
			</div>
			<div class="col-sm-6" style="">
			  <div class="mb-3">
				<label class="form-label">HTTP Connection Type</label>
					<select name="fHAHTTP" id="fHAHTTP" class="form-select" aria-label="Default select example">
					  <option value="http">http</option>
					  <option value="https">https</option>
					</select>
			  </div>
			</div>
			<div class="col-sm-6" style="">
			  <div class="mb-3">
				<label class="form-label">Home Assistant Long Live Token</label>
				<input type="text"  name="fToken" class="form-control" id="fToken" aria-describedby="emailHelp">
				<div id="emailHelp" class="form-text"><small><i>Generate a Home Assistant long live token and paste it here.</i></small></div>				
			  </div>
			</div>
			<div class="col-sm-6" style="">
			  <div class="mb-3">
				<label class="form-label">Enable Home Assistant Integration</label>
					<select name="fEnableHA" id="fEnableHA" class="form-select" aria-label="Default select example">
					  <option value=""></option>
					  <option value="Yes">Yes</option>
					  <option value="No">No</option>
					</select>
			  </div>
			</div>
			</div>
			</form>			  
			<small><small>Home assistant settings will only be shown when this device is in admin mode.</small></small>
      </div>
	  
      <div class="modal-footer">
        
		<button class="btn btn-sm btn-light" onclick="GetHASettings()" >Load Previously Saved Settings</button>
		<button type="button" class="btn btn-sm btn-light" data-bs-dismiss="modal">Close</button>    
		<button class="btn btn-sm btn-dark" onclick="FuncSaveHASettings()" data-bs-dismiss="modal" >Save</button>
			
      </div>
    </div>
  </div>
</div>	
<!-- SystemMaintanance -->
<!-- Modal -->
<div class="modal fade" id="SystemMaintanance" tabindex="-1" aria-labelledby="SetupHA" aria-hidden="true">
  <div class="modal-dialog bg-dark">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="SetupHA"><img src="chip.png" alt="Bootstrap" class="img-fluid" width="50px;"> Enable / Disable Admin Mode</h5>
      </div>
      <form>
	  <div class="modal-body">

			<div class="mb-3">
			  <label for="exampleFormControlInput1" class="form-label">Enter System Password</label>
			  <input type="password" class="form-control" id="idAdminPassword" placeholder="Enter system password" aria-label="Enter system password" aria-describedby="button-addon2">			  
			</div>
			<small><small><i>Once admin mode the recipe auto scheduler will be stopped and you have to manually execute recipe files. The recipe scheduler will resume once you exit admin mode. </i></small></small>

      </div>
      <div class="modal-footer">
        
		<button type="submit" class="btn btn-sm btn-dark" data-bs-dismiss="modal" onclick="FuncEnableAdminMode()">Enable</button>  
		<button type="button" class="btn btn-sm btn-light" data-bs-dismiss="modal">Close</button>    
		</form>
      </div>
    </div>
  </div>
</div>


<!-- Log Viewer -->
<!-- Modal -->
<div class="modal modal-xl fade" id="LogViewer" tabindex="-1" aria-labelledby="LogViewer" aria-hidden="true">
  <div class="modal-dialog bg-dark">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="LogViewer"><img src="nodes.png" alt="Bootstrap" class="img-fluid" width="50px;"> Log Viewer</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
			Serial Port Activity Log<br>
			<small><small>Logs will only show when both Admin mode and Logging is enabled..</small></small>
			<textarea class="form-control bg-dark" id="idLogViewer" rows="30" style="color:#f2b022;font-size: 10px;font-family: Verdana, sans-serif;"></textarea>
  


      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-sm btn-light" onclick="FuncLoadLog()">Refresh</button>
		<button type="button" class="btn btn-sm btn-light" onclick="FuncaskDeleteFile('log.txt')">Clear Log</button>   
		<button type="button" class="btn btn-sm btn-light" data-bs-dismiss="modal">Close</button>		 
			
      </div>
    </div>
  </div>
</div>
	

<script src="custom.js"></script>
<script src="bootstrap.bundle.js"></script>


</body>
</html>



